#!/usr/bin/env python
#-*- coding:utf-8 -*-

'''
Wiper, an assistant tool for web penetration test.
Copyright (c) 2014-2015 alpha1e0
See the file COPYING for copying detail
'''


from plugin.lib.plugin import Plugin
from plugin.lib.commons import DnsResolver
from model.model import Host


class ZoneTransPlugin(Plugin):
    '''
    Find and use DNS zone transfer vulnerability.
    '''
    def __init__(self, *args, **kwargs):
        super(ZoneTransPlugin, self).__init__(*args, **kwargs)

    def _handle(self, data):
        if not isinstance(data, Host):
            self.put(data)
        else:
            dnsresolver = DnsResolver(data.url)
            records = dnsresolver.getZoneRecords()
            for line in records:
                if line[2] == "A":
                    self.put(Host(url=line[0], ip=line[1], description="Generated by zonetrans plugin."))
                elif line[2] == "CNAME":
                    self.put(Host(url=line[0], description="Generated by zonetrans plugin. Domain alias "+line[1]))

